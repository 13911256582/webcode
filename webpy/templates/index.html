

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

{% load staticfiles %}
<link href='{% static "codemirror.css" %}' rel="stylesheet">
<script src='{% static "codemirror.js" %}' type="text/javascript" charset="utf-8"></script>
<script src='{% static "jquery.min.js" %}' type="text/javascript"></script>
<script src='{% static "addon/selection/active-line.js" %}' type="text/javascript"></script>
<script src='{% static "javascript/javascript.js" %}' type="text/javascript"></script>
<script src='{% static "clike/clike.js" %}' type="text/javascript"></script>

<script src='{% static "addon/edit/matchbrackets.js" %}'></script>
<script src='{% static "addon/edit/closebrackets.js" %}'></script>
<link rel="stylesheet" href='{% static "addon/hint/show-hint.css" %}'>
<script src='{% static "addon/hint/show-hint.js" %}'></script>

<title>Code</title>

</head>

<body>



<style type="text/css">
#e{font-size: 14px;position:relative;height:500px;width:600px;}
#console{background: black; font-family: arial; font-size:12px; color: white; position:relative; height:500px;width:600px;}
pre{margin: 0; padding-left: 5px; padding-top: 5px;}

li{
    text-decoration: none;
    position: relative;
    display: inline;
    float: left;
}

.breakpoints {width: .8em;}
.breakpoint { color: #822; }
.CodeMirror {border: 1px solid #aaa;}

</style>

<div>
    <h2> 这是一个code mirror 编辑器的测试</h2>
</div>

{% csrf_token %}
<form action='http://127.0.0.1:8000/code/' method="POST">
<ul>
    <li>
        <div id="e">
        <textarea id="code"></textarea>
        </div>    
        <div>
            <input id='submit' type='button' value='submit'/>
            <input id='run' type='button' value='run'/>
        </div>
    </li>


    <li>
        <div id='console'>

        </div>
    </li>
</ul>
    

    
</form>
</ul>

<script>

$(document).ready(function(){

var textarea = document.getElementById('code');
var editor = CodeMirror.fromTextArea(textarea, {
    matchBrackets: true,
    autoCloseBrackets: true,
    mode: "text/x-csrc",
    styleActiveLine: true,
    lineNumbers: true,
    gutters: ["breakpoints","CodeMirror-linenumbers"]
});


editor.on("gutterClick", function(cm, n) {
  var info = cm.lineInfo(n);
  cm.setGutterMarker(n, "breakpoints", info.gutterMarkers ? null : makeMarker());
});

function makeMarker() {
  var marker = document.createElement("div");
  marker.style.color = "#822";
  marker.innerHTML = "●";
  //marker.innerHTML = "->";
  return marker;
}


$("#submit").click(function(){

//var e=ace.edit("e");
//var code = e.getSession().getValue()

var code = editor.getValue();

alert(code);

objMetrics = {
                  'code': code
              };

    $.ajaxSetup({ 
        async : false 
    });  

    
    $.post("http://127.0.0.1:8000/submit/", objMetrics , function(data){


        content = '<pre>' + data + '</pre>';
        $("#console").html(content);
        //window.location.href = "http://127.0.0.1:8000/result" ;
    })
    .error(function() { alert(data); });
});

 $("#run").click(function(){

    $.get("http://127.0.0.1:8000/run/", {}, function(data){
        content = '<pre>' + data + '</pre>';
        $("#console").html(content);
    })
    .error(function() { alert(data); });

 });
});
</script>


</body>


</html>

